---
import BaseCallout from '../../components/Base/BaseCallout.astro';
import PostsCategories from '../../components/Posts/PostsCategories.astro';
import DefaultLayout from '../../layouts/DefaultLayout.astro';
import type { Post } from '../../types/post';
import { rawToPosts } from '../../util/api/posts';
import { getFileName } from '../../util/helper';

export async function getStaticPaths() {
	const rawPosts = await Astro.glob('../../content/posts/*.md');
	const posts = rawToPosts(rawPosts);
	return posts.map((post: Post) => ({
		params: { slug: getFileName(post) },
		props: { post },
	}));
}

const {
	title,
	publishDate,
	tldr,
	categories,
	description,
	permalink,
	socialImg,
	socialImgAlt,
	Content,
} = Astro.props.post;
---

<DefaultLayout
	title={title}
	description={description}
	permalink={permalink}
	socialImg={socialImg}
	socialImgAlt={socialImgAlt}
>
	<article class="post h-entry">
		<section>
			<header>
				<h1 class="title p-name">{title}</h1>
				<div class="row-space-between">
					<PostsCategories categories={categories} />
					<time class="date dt-published" datetime={publishDate}>
						<a href={permalink} class="u-url">{publishDate}</a>
					</time>
				</div>
			</header>
			<BaseCallout class="tldr p-summary">
				<strong slot="prefix">TL;DR</strong>
				{tldr}
			</BaseCallout>
			<Content class="rich-text e-content" />
		</section>
		<section>
			<BaseCallout class="follow">
				<!-- TODO links -->
				If you have any thoughts or questions feel free to share them in
				<a href="post.tweet">this thread</a> or send me an
				<a href="globals.mailto">email</a>. And if you want to stay up to date you can subscribe to
				the <a href="globals.blogFeedURL">RSS feed</a>.
			</BaseCallout>
			<div class="author">
				<a href="https://harambasic.de" rel="author" class="p-author h-card"> by Luka Harambasic</a>
			</div>
		</section>
	</article>
</DefaultLayout>
