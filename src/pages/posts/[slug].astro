---
import BaseCallout from '../../components/Base/BaseCallout.astro';
import PostsCategories from '../../components/Posts/PostsCategories.astro';
import DefaultLayout from '../../layouts/DefaultLayout.astro';
import type { Post } from '../../types/post';
import { rawToPosts } from '../../util/data/posts';
import { getFileName } from '../../util/helper';

export async function getStaticPaths() {
	const rawPosts = await Astro.glob('../../content/posts/*.md');
	const posts = rawToPosts(rawPosts);
	return posts.map((post: Post) => ({
		params: { slug: getFileName(post) },
		props: { post },
	}));
}

const {
	title,
	publishDate,
	tldr,
	categories,
	description,
	permalink,
	socialImg,
	socialImgAlt,
	Content,
} = Astro.props.post;
---

<DefaultLayout
	title={title}
	description={description}
	permalink={permalink}
	socialImg={socialImg}
	socialImgAlt={socialImgAlt}
>
	<article class="post h-entry">
		<aside>
			<time class="date dt-published" datetime={publishDate}>
				<a href={permalink} class="u-url">{publishDate}</a>
			</time>
			<PostsCategories categories={categories} />
		</aside>
		<section class="post rich-text e-content">
			<BaseCallout class="tldr p-summary" prefix="TL;DR">
				<div set:html={tldr} />
			</BaseCallout>
			<Content />
		</section>
		<footer class="rich-text">
			<div class="follow">
				<!-- TODO links -->
				If you have any thoughts or questions feel free to share them in
				<a href="post.tweet">this thread</a> or send me an
				<a href="globals.mailto">email</a>. And if you want to stay up to date you can subscribe to
				the <a href="globals.blogFeedURL">RSS feed</a>.
			</div>
			<div class="author">
				<a href="https://harambasic.de" rel="author" class="p-author h-card"> by Luka Harambasic</a>
			</div>
		</footer>
	</article>
</DefaultLayout>

<style>
	article {
		display: grid;
		grid-template-rows: auto auto;
		grid-template-columns: 70ch 1fr;
		grid-template-areas: 'post aside' 'footer footer';
		column-gap: var(--xl);
		row-gap: var(--xl);
		aside {
			grid-area: aside;
		}
		.post {
			grid-area: post;
		}
		footer {
			grid-area: footer;
			border-radius: var(--border-radius);
			background: var(--c-surface);
			padding: var(--l);
			.author {
				text-align: center;
				a {
					font-weight: 900;
					font-size: 0.9rem;
					line-height: 1.2;
					font-family: 'Source Sans Pro', sans-serif;
					letter-spacing: 0.2px;
					text-decoration: none;
					&:hover {
						text-decoration: underline;
						text-decoration-thickness: 0.15rem;
					}
				}
			}
		}
	}
</style>
